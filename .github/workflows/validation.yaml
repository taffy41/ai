name: Validate

on:
    push:
        paths:
            - 'src/*/src/Bridge/**/composer.json'
            - 'src/ai-bundle/config/options.php'
            - 'splitsh.json'
            - '.github/workflows/validation.yaml'
            - '.github/scripts/validate-bridge-naming.sh'
            - '.github/scripts/validate-bridge-splitsh.sh'
    pull_request:
        paths:
            - 'src/*/src/Bridge/**/composer.json'
            - 'src/ai-bundle/config/options.php'
            - 'splitsh.json'
            - '.github/workflows/validation.yaml'
            - '.github/scripts/validate-bridge-naming.sh'
            - '.github/scripts/validate-bridge-splitsh.sh'

concurrency:
    group: ${{ github.workflow }}-${{ github.head_ref || github.run_id }}
    cancel-in-progress: true

jobs:
    validate_stores:
        name: Store Bridges
        runs-on: ubuntu-latest
        steps:
            - name: Checkout
              uses: actions/checkout@v6

            - name: Validate store bridge naming conventions
              run: .github/scripts/validate-bridge-naming.sh store "src/store/src/Bridge/*" src/ai-bundle/config/options.php

            - name: Validate store bridges are in splitsh.json
              run: .github/scripts/validate-bridge-splitsh.sh store "src/store/src/Bridge/*"

    validate_tools:
        name: Tool Bridges
        runs-on: ubuntu-latest
        steps:
            - name: Checkout
              uses: actions/checkout@v6

            - name: Validate tool bridge naming conventions
              run: .github/scripts/validate-bridge-naming.sh tool "src/agent/src/Bridge/*"

            - name: Validate tool bridges are in splitsh.json
              run: .github/scripts/validate-bridge-splitsh.sh tool "src/agent/src/Bridge/*"
